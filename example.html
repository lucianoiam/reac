<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Reac</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- Load React or Preact -->
    <script src="https://unpkg.com/react/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom/umd/react-dom.production.min.js"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/preact/dist/preact.min.js"></script>-->

    <!-- Allow to switch between libraries without modifying component.js -->
    <script>window.React = window.React || window.preact;</script>

    <script src="renderer.js"></script>
    <script src="component.js"></script>

    <script>

    class ChildComponent extends Reac.Component {

        renderHTML() {
            return `
                <do if="${this.props.count > 0}">
                <h3>Items</h3>
                </do>
                <ul>
                    <do iterate="{ChildComponent.fruits}" count="${this.props.count}">
                    <li data-index="{i}">Item {i} - {val}</li>
                    </do>
                </ul>
            `;
        }

    }
            
    ChildComponent.fruits = ['apple', 'orange', 'banana', 'mango', 'kiwi'];


    class ParentComponent extends Reac.Component {

        constructor(props) {
            super(props, { ChildComponent });
            this.state = { count: 0, text: '' };
        }

        renderHTML() {
            return `
                <div>
                    <textarea
                        placeholder="Type something"
                        onInput="{ ev => this.setState(ps => ({ ...ps, text: ev.target.value })) }"></textarea>
                    <span>${this.state.text}</span>
                </div>
                <div>
                    <button onClick="{this.incrementCount}">Click to add item</button>
                    <ChildComponent count="${this.state.count}"></ChildComponent>
                </div>
            `;
        }

        incrementCount() {
            this.setState(ps => ({ ...ps, count: ps.count + 1 }));
        }

    }

    const root = document.getElementById('root');

    if (typeof(preact) !== 'undefined') {
        preact.render(preact.createElement(ParentComponent), root);
    } else {
        ReactDOM.createRoot(root).render(React.createElement(ParentComponent));
    }

    </script>

  </body>
</html>
